<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025년 두정초등학교 관리 시스템</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>2025년 두정초등학교 관리 시스템</h1>
            <div class="user-info" id="userInfo" style="display: none;">
                <span id="userName"></span>
                <button onclick="logout()" class="logout-btn">로그아웃</button>
            </div>
        </header>

        <main>
            <!-- 로그인 화면 -->
            <div id="loginSection">
                <div class="login-form">
                    <h2>두정초등학교 시설 관리</h2>
                    <p id="loginDescription" style="text-align: center; color: #4a5568; margin-bottom: 2rem; font-size: 0.95rem;">학교 시스템에 접속하기 위해 비밀번호를 입력해주세요</p>
                    
                    <!-- 학교 비밀번호 입력 -->
                    <div id="schoolPasswordForm">
                        <div class="form-group">
                            <label for="schoolPassword">학교 비밀번호:</label>
                            <input type="password" id="schoolPassword" name="schoolPassword" placeholder="학교 비밀번호를 입력하세요" required>
                        </div>
                        <button type="button" onclick="verifySchoolPassword()">다음</button>
                    </div>

                    <!-- 선생님 로그인 -->
                    <div id="gradeClassForm" style="display: none;">
                        <div class="grade-selection">
                            <h3>학년을 선택해주세요</h3>
                            <div class="grade-buttons">
                                <button type="button" class="grade-btn" data-grade="1">1학년</button>
                                <button type="button" class="grade-btn" data-grade="2">2학년</button>
                                <button type="button" class="grade-btn" data-grade="3">3학년</button>
                                <button type="button" class="grade-btn" data-grade="4">4학년</button>
                                <button type="button" class="grade-btn" data-grade="5">5학년</button>
                                <button type="button" class="grade-btn" data-grade="6">6학년</button>
                            </div>
                        </div>
                        <div class="class-selection" id="classSelection" style="display: none;">
                            <h3 id="selectedGradeTitle">반을 선택해주세요</h3>
                            <div class="class-buttons" id="classButtons">
                                <!-- 학년 선택 후 동적 생성 -->
                            </div>
                            <button type="button" class="back-btn" onclick="showGradeSelection()">← 학년 선택으로 돌아가기</button>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1.5rem;">
                        <button type="button" onclick="showAdminLogin()" style="background: transparent; border: none; color: #718096; font-size: 0.85rem; cursor: pointer; text-decoration: underline;">관리자로 로그인</button>
                    </div>
                    
                    <!-- 관리자 로그인 (숨겨짐) -->
                    <div id="adminLoginForm" style="display: none; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #e2e8f0;">
                        <form id="adminForm">
                            <div class="form-group">
                                <label for="adminPassword">관리자 비밀번호:</label>
                                <input type="password" id="adminPassword" name="adminPassword" placeholder="관리자 비밀번호를 입력하세요" required>
                            </div>
                            <button type="submit">관리자 로그인</button>
                        </form>
                        <div style="text-align: center; margin-top: 1rem;">
                            <button type="button" onclick="hideAdminLogin()" style="background: transparent; border: none; color: #718096; font-size: 0.85rem; cursor: pointer; text-decoration: underline;">선생님 로그인으로 돌아가기</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 선생님 메뉴 -->
            <div id="teacherSection" style="display: none;">
                <div class="menu-grid">
                    <div class="menu-item" onclick="openPage('computer-room')">
                        <h3>컴퓨터실/공유기 예약</h3>
                        <p>컴퓨터실과 공유기를 예약합니다</p>
                    </div>
                    <div class="menu-item disabled" onclick="showUpdateMessage('science-supplies')">
                        <h3>과학실 준비물 신청</h3>
                        <p>🔄 업데이트 예정</p>
                    </div>
                    <div class="menu-item" onclick="window.open('https://docs.google.com/spreadsheets/d/10hevdZ2pwIfNjpfnmVD275eH38b-sWBytjj8J6fWqzQ/edit?usp=sharing', '_blank')">
                        <h3>정보기기 유지보수 대장</h3>
                        <p>정보기기 유기보수 현황을 확인합니다</p>
                    </div>
                    <div class="menu-item" onclick="window.open('https://docs.google.com/spreadsheets/d/1AbB2kzRzzTyBxDhkjyqcASnn5rhgnLzPD94KoHfCBpc/edit?usp=sharing', '_blank')">
                        <h3>두전빼</h3>
                        <p>두전빼 관련 문서를 확인합니다</p>
                    </div>
                </div>
            </div>

            <!-- 관리자 메뉴 -->
            <div id="adminSection" style="display: none;">
                <div class="admin-dashboard">
                    <h2>관리자 대시보드</h2>
                    <div class="dashboard-stats">
                        <div class="stat-item">
                            <h3>대기중인 신청</h3>
                            <span id="pendingRequests">0</span>
                        </div>
                        <div class="stat-item">
                            <h3>오늘 처리된 신청</h3>
                            <span id="todayProcessed">0</span>
                        </div>
                        <div class="stat-item">
                            <h3>전체 신청</h3>
                            <span id="totalRequests">0</span>
                        </div>
                    </div>
                    
                    <div class="admin-menu-grid">
                        <div class="menu-item" onclick="openAdminPage('computer-room-manage')">
                            <h3>컴퓨터실 신청 관리</h3>
                            <p>컴퓨터실 사용 신청을 관리합니다</p>
                        </div>
                        <div class="menu-item" onclick="openAdminPage('tablet-manage')">
                            <h3>태블릿 정보 관리</h3>
                            <p>태블릿 공유기 정보를 관리합니다</p>
                        </div>
                        <div class="menu-item" onclick="openAdminPage('science-manage')">
                            <h3>과학실 준비물 관리</h3>
                            <p>과학실 준비물 신청을 관리합니다</p>
                        </div>
                        <div class="menu-item" onclick="openAdminPage('maintenance-manage')">
                            <h3>유지보수 신청 관리</h3>
                            <p>컴퓨터 유지보수 신청을 관리합니다</p>
                        </div>
                        <div class="menu-item" onclick="openAdminPage('toner-manage')">
                            <h3>토너 신청 관리</h3>
                            <p>토너 신청을 관리합니다</p>
                        </div>
                        <div class="menu-item" onclick="window.open('https://docs.google.com/spreadsheets/d/10hevdZ2pwIfNjpfnmVD275eH38b-sWBytjj8J6fWqzQ/edit?usp=sharing', '_blank')">
                            <h3>정보기기 유지보수 대장</h3>
                            <p>정보기기 유기보수 현황을 관리합니다</p>
                        </div>
                        <div class="menu-item" onclick="window.open('https://docs.google.com/spreadsheets/d/1AbB2kzRzzTyBxDhkjyqcASnn5rhgnLzPD94KoHfCBpc/edit?usp=sharing', '_blank')">
                            <h3>두전빼</h3>
                            <p>두전빼 관련 문서를 관리합니다</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore-compat.js"></script>
    
    <!-- Firebase 설정 및 초기화 -->
    <script>
    // 로컬 firebase-config.js 파일을 먼저 시도, 실패하면 데모 모드
    function loadFirebaseConfig() {
        return new Promise((resolve) => {
            const script = document.createElement('script');
            script.src = 'js/firebase-config.js';
            script.onload = () => {
                console.log("✅ 로컬 Firebase 설정 로드됨");
                resolve(true);
            };
            script.onerror = () => {
                console.log("⚠️ 로컬 Firebase 설정 없음 - 데모 모드 사용");
                // 실제 Firebase 설정 (GitHub Pages용)
                window.firebaseConfig = {
                    apiKey: "AIzaSyDuZCkvcLJIHNwReb2HBRh2kvQaOjdfsEQ",
                    authDomain: "dujeong-dujeong.firebaseapp.com",
                    projectId: "dujeong-dujeong",
                    storageBucket: "dujeong-dujeong.firebasestorage.app",
                    messagingSenderId: "1099110427861",
                    appId: "1:1099110427861:web:1585e05befc3cc37c5065c"
                };
                
                // Firebase 초기화 (GitHub Pages용)
                try {
                    firebase.initializeApp(window.firebaseConfig);
                    window.db = firebase.firestore();
                    window.isFirebaseEnabled = true;
                    console.log("✅ Firebase 연결됨 - GitHub Pages");
                } catch (error) {
                    console.error("❌ Firebase 초기화 실패:", error);
                    window.isFirebaseEnabled = false;
                }
                resolve(false);
            };
            document.head.appendChild(script);
        });
    }
    
    // Firebase 설정 로드 후 초기화
    loadFirebaseConfig().then(() => {
        // firebase-config.js가 로드되면 initializeFirebase() 함수가 실행됨
        // 로드되지 않으면 여기서 직접 처리
        if (!window.isFirebaseEnabled) {
            console.log("⚡ Firebase 미설정 - localStorage 사용 (데모 모드)");
        }
    });
    </script>
    <script src="js/database.js"></script>
    <script src="js/main.js"></script>
</body>
</html>